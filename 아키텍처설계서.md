# Exodus Trading System 아키텍처 설계서

**프로젝트명:** Exodus Trading System
**작성일:** 2025-10-28
**버전:** 1.0

---

## 목차

1. [개요](#1-개요)
2. [아키텍처 원칙](#2-아키텍처-원칙)
3. [시스템 컨텍스트](#3-시스템-컨텍스트)
4. [컨테이너 아키텍처](#4-컨테이너-아키텍처)
5. [컴포넌트 아키텍처](#5-컴포넌트-아키텍처)
6. [데이터 아키텍처](#6-데이터-아키텍처)
7. [배포 아키텍처](#7-배포-아키텍처)
8. [보안 아키텍처](#8-보안-아키텍처)
9. [확장성 및 성능](#9-확장성-및-성능)

---

## 1. 개요

### 1.1 문서 목적
본 문서는 Exodus Trading System의 소프트웨어 아키텍처를 정의하고, 시스템의 구조, 컴포넌트 간 상호작용, 데이터 흐름을 명확히 한다.

### 1.2 아키텍처 스타일
- **Layered Architecture**: Frontend, Backend, Data Layer 분리
- **Microservices-ready**: 향후 확장을 위한 서비스 지향 구조
- **Event-Driven**: WebSocket을 통한 실시간 이벤트 처리
- **RESTful API**: 클라이언트-서버 통신

---

## 2. 아키텍처 원칙

### 2.1 설계 원칙

#### 관심사의 분리 (Separation of Concerns)
- Frontend와 Backend의 명확한 분리
- 각 레이어는 독립적으로 개발/배포 가능
- 비즈니스 로직과 데이터 접근 로직 분리

#### 느슨한 결합 (Loose Coupling)
- REST API를 통한 통신
- 의존성 주입(Dependency Injection) 활용
- 인터페이스 기반 설계

#### 높은 응집도 (High Cohesion)
- 관련 기능을 하나의 모듈로 그룹화
- 단일 책임 원칙(Single Responsibility Principle) 준수

#### 확장 가능성 (Scalability)
- 수평 확장 가능한 구조
- 캐싱 레이어 활용
- 비동기 처리 지원

#### 보안 우선 (Security First)
- JWT 기반 인증/인가
- 모든 민감 데이터 암호화
- HTTPS 강제

---

## 3. 시스템 컨텍스트

### 3.1 시스템 경계

**Exodus Trading System**은 다음과 같은 외부 시스템 및 액터와 상호작용합니다:

#### 액터 (Actors)
- **투자자 (Investor)**: 웹 브라우저를 통해 시스템 접근
- **관리자 (Admin)**: 시스템 관리 및 모니터링

#### 외부 시스템
- **한국투자증권 OpenAPI**: 시장 데이터 조회 및 주문 실행
- **이메일 서비스**: 알림 발송 (Gmail SMTP, SendGrid 등)

### 3.2 주요 기능
1. 사용자 인증 및 권한 관리
2. 시장 데이터 수집 및 저장
3. 투자 전략 관리 및 실행
4. 백테스트 시뮬레이션
5. 자동매매 실행
6. 계좌 및 포트폴리오 관리
7. 실시간 모니터링 및 알림

---

## 4. 컨테이너 아키텍처

### 4.1 컨테이너 구성

시스템은 다음 5개의 주요 컨테이너로 구성됩니다:

#### 1. **Frontend Container (Next.js)**
- **기술**: React 18+, Next.js 14+, TypeScript
- **역할**: 사용자 인터페이스 제공
- **주요 기능**:
  - 사용자 인증 UI
  - 대시보드 및 차트 시각화
  - 전략 관리 UI
  - 백테스트 결과 표시
- **통신**: REST API, WebSocket (Backend와 통신)

#### 2. **Backend API Container (FastAPI)**
- **기술**: Python 3.11+, FastAPI, SQLAlchemy
- **역할**: 비즈니스 로직 처리 및 API 제공
- **주요 기능**:
  - JWT 인증/인가
  - REST API 엔드포인트
  - WebSocket 서버
  - 비즈니스 로직 실행
- **통신**: PostgreSQL, Redis, 한국투자증권 API

#### 3. **Worker Container (Background Tasks)**
- **기술**: Python, Celery, APScheduler
- **역할**: 백그라운드 작업 실행
- **주요 기능**:
  - 자동매매 스케줄링
  - 시장 데이터 주기적 수집
  - 백테스트 실행
  - 신호 생성 및 주문 실행
- **통신**: Redis (Task Queue), PostgreSQL

#### 4. **Database Container (PostgreSQL)**
- **기술**: PostgreSQL 15+
- **역할**: 영구 데이터 저장
- **저장 데이터**:
  - 사용자 정보
  - 투자 전략
  - 거래 이력
  - 시계열 데이터
  - 백테스트 결과

#### 5. **Cache Container (Redis)**
- **기술**: Redis 7+
- **역할**: 캐싱 및 메시지 브로커
- **주요 용도**:
  - 세션 저장
  - API 응답 캐싱
  - Celery Task Queue
  - Rate Limiting

#### 6. **Reverse Proxy (Nginx)** - Optional
- **기술**: Nginx
- **역할**: 리버스 프록시 및 로드 밸런싱
- **주요 기능**:
  - HTTPS 종료
  - 정적 파일 서빙
  - API Gateway

---

## 5. 컴포넌트 아키텍처

### 5.1 Backend 컴포넌트 구조

```
backend/
├── api/                      # API Layer
│   ├── v1/
│   │   ├── auth.py          # 인증 API
│   │   ├── account.py       # 계좌 관리 API
│   │   ├── strategies.py    # 전략 관리 API
│   │   ├── backtest.py      # 백테스트 API
│   │   ├── orders.py        # 주문 API
│   │   ├── signals.py       # 신호 API
│   │   └── market.py        # 시장 데이터 API
│   └── deps.py              # 의존성 주입
│
├── core/                     # Core Layer
│   ├── trading/             # Trading Engine
│   │   ├── strategy_manager.py
│   │   ├── signal_generator.py
│   │   ├── order_executor.py
│   │   └── risk_manager.py
│   ├── backtest/            # Backtest Engine
│   │   ├── engine.py
│   │   ├── metrics.py
│   │   └── portfolio.py
│   └── scheduler/           # Scheduler
│       ├── trading_scheduler.py
│       └── data_collector.py
│
├── services/                 # Service Layer
│   ├── user_service.py
│   ├── account_service.py
│   ├── market_data_service.py
│   ├── kis_api_service.py   # 한국투자증권 API
│   └── notification_service.py
│
├── models/                   # Data Models (ORM)
│   ├── user.py
│   ├── strategy.py
│   ├── order.py
│   ├── trade.py
│   ├── signal.py
│   └── market_data.py
│
├── schemas/                  # Pydantic Schemas
│   ├── user.py
│   ├── strategy.py
│   ├── order.py
│   └── ...
│
├── database/                 # Database
│   ├── session.py
│   └── base.py
│
├── auth/                     # Authentication
│   ├── jwt.py
│   ├── security.py
│   └── dependencies.py
│
├── utils/                    # Utilities
│   ├── logger.py
│   ├── exceptions.py
│   └── validators.py
│
└── config/                   # Configuration
    └── settings.py
```

### 5.2 Frontend 컴포넌트 구조

```
frontend/
├── app/                      # Next.js App Router
│   ├── (auth)/
│   │   ├── login/
│   │   └── register/
│   ├── (dashboard)/
│   │   ├── dashboard/
│   │   ├── holdings/
│   │   ├── strategies/
│   │   ├── backtest/
│   │   ├── trading/
│   │   ├── history/
│   │   └── settings/
│   ├── layout.tsx
│   └── page.tsx
│
├── components/               # React Components
│   ├── ui/                  # shadcn/ui components
│   ├── layout/
│   │   ├── Header.tsx
│   │   ├── Sidebar.tsx
│   │   └── Footer.tsx
│   ├── dashboard/
│   │   ├── AccountSummary.tsx
│   │   ├── PortfolioChart.tsx
│   │   └── RecentTrades.tsx
│   ├── strategies/
│   │   ├── StrategyList.tsx
│   │   ├── StrategyForm.tsx
│   │   └── StrategyCard.tsx
│   ├── backtest/
│   │   ├── BacktestForm.tsx
│   │   └── BacktestResults.tsx
│   └── charts/
│       ├── CandlestickChart.tsx
│       ├── LineChart.tsx
│       └── PerformanceChart.tsx
│
├── lib/                      # Utilities
│   ├── api.ts               # API Client
│   ├── auth.ts              # Auth helpers
│   ├── websocket.ts         # WebSocket client
│   └── utils.ts
│
├── hooks/                    # Custom Hooks
│   ├── useAuth.ts
│   ├── useWebSocket.ts
│   ├── useStrategies.ts
│   └── useMarketData.ts
│
├── stores/                   # State Management (Zustand)
│   ├── authStore.ts
│   ├── marketStore.ts
│   └── strategyStore.ts
│
└── types/                    # TypeScript Types
    ├── api.ts
    ├── strategy.ts
    └── market.ts
```

---

## 6. 데이터 아키텍처

### 6.1 데이터베이스 스키마 설계

#### 주요 엔티티

**1. users (사용자)**
- id (PK)
- email (Unique)
- hashed_password
- full_name
- role (admin, user, viewer)
- is_active
- created_at
- updated_at

**2. strategies (투자 전략)**
- id (PK)
- user_id (FK → users)
- name
- description
- strategy_type (momentum, mean_reversion, factor)
- parameters (JSON)
- is_active
- created_at
- updated_at

**3. signals (매매 신호)**
- id (PK)
- strategy_id (FK → strategies)
- symbol
- signal_type (buy, sell, hold)
- confidence_score
- price
- quantity
- reason (JSON)
- created_at

**4. orders (주문)**
- id (PK)
- user_id (FK → users)
- signal_id (FK → signals, nullable)
- symbol
- order_type (market, limit)
- side (buy, sell)
- quantity
- price
- status (pending, filled, cancelled)
- filled_quantity
- filled_price
- kis_order_id
- created_at
- updated_at

**5. trades (체결)**
- id (PK)
- order_id (FK → orders)
- user_id (FK → users)
- symbol
- side (buy, sell)
- quantity
- price
- commission
- tax
- executed_at

**6. holdings (보유 종목)**
- id (PK)
- user_id (FK → users)
- symbol
- quantity
- average_price
- current_price
- unrealized_pnl
- updated_at

**7. market_data (시장 데이터)**
- id (PK)
- symbol
- timestamp
- open
- high
- low
- close
- volume
- interval (1m, 5m, 1h, 1d)

**8. backtest_results (백테스트 결과)**
- id (PK)
- strategy_id (FK → strategies)
- user_id (FK → users)
- start_date
- end_date
- initial_capital
- final_capital
- total_return
- annual_return
- max_drawdown
- sharpe_ratio
- win_rate
- trades_count
- results (JSON) - 상세 결과
- created_at

**9. account_snapshots (계좌 스냅샷)**
- id (PK)
- user_id (FK → users)
- total_assets
- cash_balance
- stock_value
- realized_pnl
- unrealized_pnl
- snapshot_date

### 6.2 데이터 흐름

#### 실시간 데이터 수집
```
한국투자증권 API → Market Data Service → PostgreSQL
                                      ↓
                                    Redis (Cache)
                                      ↓
                                  WebSocket → Frontend
```

#### 자동매매 플로우
```
Scheduler → Strategy Manager → Signal Generator → Order Executor → 한국투자증권 API
                                     ↓                    ↓
                              PostgreSQL (signals)  PostgreSQL (orders/trades)
                                     ↓
                              WebSocket → Frontend (알림)
```

---

## 7. 배포 아키텍처

### 7.1 Docker Compose 구성

```yaml
version: '3.8'

services:
  frontend:
    container_name: exodus-frontend
    ports:
      - "3000:3000"
    depends_on:
      - backend

  backend:
    container_name: exodus-backend
    ports:
      - "8000:8000"
    depends_on:
      - postgres
      - redis

  worker:
    container_name: exodus-worker
    depends_on:
      - postgres
      - redis
      - backend

  postgres:
    container_name: exodus-postgres
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    container_name: exodus-redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

  nginx:
    container_name: exodus-nginx
    ports:
      - "80:80"
      - "443:443"
    depends_on:
      - frontend
      - backend
```

### 7.2 네트워크 구성

- **exodus-network**: 모든 컨테이너가 속한 내부 네트워크
- Frontend ↔ Backend: HTTP/WebSocket
- Backend ↔ PostgreSQL: TCP (5432)
- Backend ↔ Redis: TCP (6379)
- Nginx ↔ Frontend/Backend: Reverse Proxy

---

## 8. 보안 아키텍처

### 8.1 인증 플로우

```
1. 사용자 로그인
   User → Frontend → POST /api/v1/auth/login → Backend

2. JWT 토큰 발급
   Backend → Access Token (1시간) + Refresh Token (7일) → Frontend

3. 토큰 저장
   Frontend → localStorage/Cookie (Refresh Token은 HttpOnly Cookie 권장)

4. API 요청
   Frontend → Authorization: Bearer {access_token} → Backend

5. 토큰 검증
   Backend → JWT 검증 → 요청 처리

6. 토큰 갱신
   Frontend → POST /api/v1/auth/refresh (Refresh Token) → Backend
   Backend → 새로운 Access Token → Frontend
```

### 8.2 보안 레이어

#### API Gateway Level
- Rate Limiting (분당 100회)
- CORS 정책 적용
- HTTPS 강제

#### Application Level
- JWT 토큰 검증
- 역할 기반 접근 제어 (RBAC)
- Input Validation
- SQL Injection 방어 (ORM 사용)
- XSS 방어

#### Data Level
- 비밀번호 해싱 (bcrypt)
- 민감 데이터 암호화
- 환경 변수로 secrets 관리

---

## 9. 확장성 및 성능

### 9.1 수평 확장 전략

#### Backend API
- 무상태(Stateless) 설계
- 세션을 Redis에 저장
- 로드 밸런서를 통한 여러 인스턴스 운영

#### Worker
- Celery Worker 인스턴스 추가
- Task Queue 분산 처리

#### Database
- Read Replica 추가 (읽기 부하 분산)
- Connection Pooling

### 9.2 캐싱 전략

#### Redis 캐싱
- **시장 데이터**: 1분 TTL
- **계좌 정보**: 30초 TTL
- **전략 목록**: 5분 TTL
- **백테스트 결과**: 1시간 TTL

### 9.3 성능 최적화

- **Database Indexing**: 자주 조회되는 컬럼에 인덱스
- **Lazy Loading**: 필요한 데이터만 로드
- **Pagination**: 대량 데이터 조회 시
- **WebSocket**: 실시간 데이터는 Polling 대신 WebSocket
- **CDN**: 정적 파일 (Frontend) 배포

---

## 10. 모니터링 및 로깅

### 10.1 로깅 전략

- **Application Logs**: Loguru (Python), Winston (Node.js)
- **Access Logs**: Nginx
- **Error Tracking**: Sentry (선택적)

### 10.2 모니터링 (Phase 3)

- **메트릭 수집**: Prometheus
- **시각화**: Grafana
- **알림**: Alertmanager

---

**버전 히스토리**

| 버전 | 날짜 | 작성자 | 변경 내역 |
|------|------|--------|-----------|
| 1.0  | 2025-10-28 | - | 초안 작성 |
